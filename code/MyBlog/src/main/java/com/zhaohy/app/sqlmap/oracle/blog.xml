<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhaohy.app.dao.BlogMapper">
	<update id="uploadBlog" parameterType="java.util.HashMap">
		<if test="existType == 0">
		insert into dm_blog 
        values(nvl((select max(blog_id) + 1 from dm_blog),1),'${blogName}','${blogAuthorId}','${blogCollectionId}'
        ,to_date('${sysdate}','YYYYMMDDhh24miss'),to_date('${sysdate}','YYYYMMDDhh24miss'),${updateAuthorId},'${url}','${blogUrlName}','${describe}')
		</if>
		<if test="existType == 1">
		update dm_blog set update_time = to_date('${sysdate}','YYYYMMDDhh24miss'),update_author_id = ${updateAuthorId},describe = '${describe}'
		</if>
	</update>
	
	<!-- 获取文集数据 -->
	<select id="getCollectionList" resultType="java.util.HashMap">
	select * from dm_collection where collection_author_id = ${collectionAuthorId}
	</select>
	
	<!-- 获取文章 -->
	<select id="getBlogList" resultType="java.util.HashMap">
	select dc.collection_id,dc.collection_name,db.blog_id,db.blog_name,db.blogurlname,to_char(db.update_time,'YYYY-MM-DD hh24:mi:ss') update_time 
		from dm_collection dc
		inner join dm_blog db on dc.collection_id = db.blog_collection_id and dc.collection_author_id = db.blog_author_id
		where dc.collection_author_id = 1
		order by db.create_time desc
	</select>
	
	<!-- 根据名字查询文章 -->
	<select id="getBlogListByName" resultType="java.util.HashMap">
	select * from dm_blog b 
	inner join dm_collection dc on dc.collection_id = b.blog_collection_id and dc.collection_author_id = b.blog_author_id
	where b.blog_author_id = '${blogAuthorId}' and b.blog_collection_id = ${blogCollectionId} 
	and b.blog_name = '${blogName}'
	</select>
</mapper>